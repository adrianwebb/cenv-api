parents:
  - module: cluster
    profile: aws/config

  - module: cluster
    profile: aws/domain

  - aws/config

group:
  "@admin_server_group":
  "@admin_cluster_group":
  "@admin_group":
    - "@admin_server_group"
    - "@admin_cluster_group"

domain:
  "@root_domain":
    keep: true
    certificate_authority: letsencrypt

firewall:
  admin-command-external:
    network: "@aws_networks"
    groups: "@admin_group"
    rules:
      tcp_in:
        mode: ingress
        protocol: tcp
        from_port: "@admin_command_port"
        to_port: "@admin_command_port"

  admin-command-internal:
    requires: admin-command-external
    network: "@aws_networks"
    groups: "@admin_group"
    rules:
      tcp_in:
        mode: ingress
        protocol: tcp
        from_port: "@admin_command_port"
        to_port: "@admin_command_port"
        source_firewall: admin-command-external

  admin-data-external:
    network: "@aws_networks"
    groups: "@admin_group"
    rules:
      tcp_in:
        mode: ingress
        protocol: tcp
        from_port: "@admin_data_port"
        to_port: "@admin_data_port"

  admin-data-internal:
    requires: admin-data-external
    network: "@aws_networks"
    groups: "@admin_group"
    rules:
      tcp_in:
        mode: ingress
        protocol: tcp
        from_port: "@admin_data_port"
        to_port: "@admin_data_port"
        source_firewall: admin-data-external
